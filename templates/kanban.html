  <!-- justo antes de cerrar </body> -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <script>
  window.addEventListener('DOMContentLoaded', () => {
    // 1) Inicializa Sortable en cada columna
    document.querySelectorAll('.column-list').forEach(list => {
      Sortable.create(list, {
        group: 'kanban',
        animation: 150,
        ghostClass: 'sortable-ghost',    // clase para el elemento fantasma
        scroll: true,                    // habilita autoscroll
        scrollSensitivity: 60,
        scrollSpeed: 10,
        onEnd: evt => {
          const numero = evt.item.dataset.chatNum;
          const nuevaCol = evt.to.closest('.kanban-column').dataset.colId;
          fetch('/kanban/mover', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ numero, columna_id: nuevaCol })
          });
        }
      });
    });

    // 2) Modal al hacer clic (mantener nÃºm. de chat correctamente)
    document.querySelectorAll('.kanban-card').forEach(card => {
      card.addEventListener('click', () => {
        const num = card.dataset.chatNum;
        fetch(`/chats/${num}?partial=1`)
          .then(r => r.text())
          .then(html => {
            const modal = document.createElement('div');
            modal.className = 'kanban-modal';
            modal.innerHTML = html;
            document.body.appendChild(modal);
          });
      });
    });
  });
  </script>
